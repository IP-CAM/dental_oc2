<modification>
    <id>Adds Product Configuration Database Tables</id>
    <version>1.0]</version>
    <vqmver>1.0</vqmver>
    <author>itsgeniusstar@gmail.com</author>

    <file name="admin/controller/catalog/product.php">
        <operation>
            <search position="replace"><![CDATA[
                public function index() {
                ]]></search>
            <add><![CDATA[
                protected function getLanguages(){
                  $res = $this->db->query("Select * FROM ".DB_PREFIX."language WHERE code <>'en'");
                  $array = array();  
                  foreach($res->rows as $row){
                    $array[] = "value_".$row['code'];
                  }
                  return $array;
                }
                protected function add_column_custom($table,$languages){
                    $query = $this->db->query("SHOW COLUMNS FROM ".DB_PREFIX.$table);
                    $rows = $query->rows;
                    $fields = array();
                    foreach($rows as $field){
                        $fields[] = $field['Field'];
                    }
                    foreach($languages as $column){
                        if(!in_array($column,$fields)){
                            $query = "ALTER TABLE ".DB_PREFIX.$table." ADD COLUMN ".$column." varchar(150) NOT NULL after value";
                            $this->db->query($query);;
                        }
                    }
                
                }
                protected function dbProductArcade($languages){
                    $query = $this->db->query("SHOW Tables FROM ".DB_DATABASE." LIKE  '".DB_PREFIX."conf_product_arcade'");
                    if(!$query->num_rows){
                        $sql = "CREATE TABLE IF NOT EXISTS  ".DB_PREFIX."conf_product_arcade (
                               `id` int(11) unsigned NOT NULL AUTO_INCREMENT,                  
                               `value` varchar(150) NOT NULL,
                               `date_added` datetime NOT NULL,
                               `date_modified` datetime NOT NULL,

                               PRIMARY KEY (`id`)
                             ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;";
                           
                        $this->db->query($sql);
                    }
                
                    $this->add_column_custom("conf_product_arcade",$languages);
                    
                    
                }
                protected function dbTamanho($languages){
                    $query = $this->db->query("SHOW Tables FROM ".DB_DATABASE." LIKE  '".DB_PREFIX."conf_product_tamanho'");
                    if(!$query->num_rows){
                     $sql = "CREATE TABLE IF NOT EXISTS  ".DB_PREFIX."conf_product_tamanho (
                            `id` int(11) unsigned NOT NULL AUTO_INCREMENT,                  

                            `value` varchar(150) NOT NULL,
                            `date_added` datetime NOT NULL,
                            `date_modified` datetime NOT NULL,

                            PRIMARY KEY (`id`)
                          ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;";
                  
                    $this->db->query($sql);
                    }
                    $this->add_column_custom("conf_product_tamanho",$languages);
                }
                protected function dbCor($languages){
                    $query = $this->db->query("SHOW Tables FROM ".DB_DATABASE." LIKE  '".DB_PREFIX."conf_product_cor'");
                    if(!$query->num_rows){
                     $sql = "CREATE TABLE IF NOT EXISTS  ".DB_PREFIX."conf_product_cor (
                            `id` int(11) unsigned NOT NULL AUTO_INCREMENT,                  

                            `value` varchar(150) NOT NULL,
                            `date_added` datetime NOT NULL,
                            `date_modified` datetime NOT NULL,

                            PRIMARY KEY (`id`)
                          ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;";
                    $this->db->query($sql);
                    }
                    $this->add_column_custom("conf_product_cor",$languages);
                }
                public function index() {
                    $languages = $this->getLanguages();
                   
                    $this->dbProductArcade($languages);
                    $this->dbTamanho($languages);
                    $this->dbCor($languages);
                    
               
                ]]>
            </add>
        </operation>
  ]
    </file>	



</modification>






